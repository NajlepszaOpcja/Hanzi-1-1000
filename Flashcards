
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Chinese Flashcards</title>
<style>
body {
  background: #000000;
  color: #f0f0f0;
  font-family: sans-serif;
  margin: 0;
  padding: 0;
}
.flashcard {
  max-width: 400px;
  max-height: 400px;
  margin: 20px auto;
  text-align: center;
}
.hanzi {
  font-size: 120px;
  margin-bottom: 20px;
  line-height: 1;
}
.options {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 10px;
  margin-bottom: 20px;
}
.option-btn {
  background: #333;
  color: white;
  border: none;
  padding: 10px 20px;
  font-size: 18px;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.3s;
}
.option-btn:hover {
  background: #555;
}
.option-btn.correct {
  background: #4caf50;
}
.option-btn.wrong {
  background: #f44336;
}
.next-btn {
  padding: 10px 20px;
  font-size: 18px;
  cursor: pointer;
  border-radius: 8px;
  background: #333;
  color: white;
  border: #ffffff;
  display: none;
}
#pinyin {
  margin-top: 10px;
  margin-bottom: 20px;
  font-size: 24px;
  color: white;
  line-height: 1.2;
}
#error-msg {
  color: #f44336;
  text-align: center;
  margin-top: 20px;
}
</style>
</head>
<body>

<div class="flashcard">
  <div id="hanzi" class="hanzi">加载中...</div>
  <div id="pinyin"></div>
  <div id="options" class="options"></div>
  <button id="next" class="next-btn">Next</button>
</div>
<div id="error-msg"></div>

<script>
const hanziDiv = document.getElementById("hanzi");
const optionsDiv = document.getElementById("options");
const nextBtn = document.getElementById("next");
const pinyinDiv = document.getElementById("pinyin");
const errorMsg = document.getElementById("error-msg");

let data = [];

function shuffleArray(array) {
  // Fisher-Yates shuffle for better randomness
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

function parseCSV(text) {
  // Zakładam format: hanzi,pinyin,english (pojedyncza linia)
  const lines = text.trim().split('\n');
  const result = [];
  for (let line of lines) {
    // Najprostszy split po przecinku, ale english może mieć przecinki, więc:
    // podziel linię na 3 części: hanzi, pinyin, reszta jako english
    const firstComma = line.indexOf(',');
    const secondComma = line.indexOf(',', firstComma + 1);
    if (firstComma === -1 || secondComma === -1) continue; // niepoprawna linia

    const hanzi = line.slice(0, firstComma).trim();
    const pinyin = line.slice(firstComma + 1, secondComma).trim();
    const english = line.slice(secondComma + 1).trim();

    if (hanzi && pinyin && english) {
      result.push({ hanzi, pinyin, english });
    }
  }
  return result;
}

function loadFlashcard() {
  optionsDiv.innerHTML = "";
  nextBtn.style.display = "none";
  pinyinDiv.textContent = "";

  if (data.length === 0) {
    hanziDiv.textContent = "Brak danych do wyświetlenia.";
    return;
  }

  const correctItem = data[Math.floor(Math.random() * data.length)];
  hanziDiv.textContent = correctItem.hanzi;

  // Tworzymy listę opcji - angielskie tłumaczenia
  const options = [correctItem.english];
  while (options.length < 4 && options.length < data.length) {
    const randomOption = data[Math.floor(Math.random() * data.length)].english;
    if (!options.includes(randomOption)) {
      options.push(randomOption);
    }
  }

  shuffleArray(options);

  options.forEach(optionText => {
    const btn = document.createElement("button");
    btn.textContent = optionText;
    btn.className = "option-btn";
    btn.addEventListener("click", () => handleAnswer(btn, optionText, correctItem));
    optionsDiv.appendChild(btn);
  });
}

function handleAnswer(button, selected, correctItem) {
  const buttons = document.querySelectorAll(".option-btn");
  buttons.forEach(btn => {
    btn.disabled = true;
    if (btn.textContent === correctItem.english) {
      btn.classList.add("correct");
    } else if (btn.textContent === selected) {
      btn.classList.add("wrong");
    }
  });
  pinyinDiv.textContent = correctItem.pinyin;
  nextBtn.style.display = "block";
}

nextBtn.addEventListener("click", loadFlashcard);

// Pobierz i załaduj dane z pliku CSV
fetch("https://najlepszaopcja.com/wp-content/uploads/2025/07/1-1000-Hanzi-03.txt")
  .then(response => {
    if (!response.ok) throw new Error("Nie udało się pobrać danych.");
    return response.text();
  })
  .then(text => {
    data = parseCSV(text);
    if (data.length === 0) {
      hanziDiv.textContent = "Plik jest pusty lub ma zły format.";
      return;
    }
    loadFlashcard();
  })
  .catch(error => {
    hanziDiv.textContent = "Błąd ładowania danych.";
    errorMsg.textContent = error.message;
  });
</script>

</body>
</html>
